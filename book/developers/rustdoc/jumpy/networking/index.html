<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Networked multi-player plugin."><meta name="keywords" content="rust, rustlang, rust-lang, networking"><title>jumpy::networking - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-6827029ac823cab7.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-ebce58d0a40c3431.css"><link rel="stylesheet" disabled href="../../static.files/dark-f23faae4a2daf9a6.css"><link rel="stylesheet" disabled href="../../static.files/ayu-8af5e100b21cd173.css"><script id="default-settings" ></script><script src="../../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="../../static.files/main-c55e1eb52e1886b4.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"><script src='https://unpkg.com/panzoom@9.4.0/dist/panzoom.min.js'></script>
<script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10.2.2/dist/mermaid.esm.min.mjs"
    mermaid.initialize({
        startOnLoad: false,
        securityLevel: 'loose',
        theme: 'dark',
        themeVariables: {
            fontSize: '16px',
            lineColor: '#F8B229',
            clusterBkg: '#0000',
            edgeLabelBackground: '#1A1A1A'
        }
    });
    mermaid.run({
        querySelector: '.mermaid',
        postRenderCallback: id => {
            let el = document.getElementById(id);
            const pz = panzoom(el, {
                smoothScroll: false,
                zoomDoubleClickSpeed: 1,
                beforeWheel: function (e) {
                    // allow wheel-zoom only if ctrl is down. Otherwise - ignore
                    var shouldIgnore = !e.ctrlKey;
                    return shouldIgnore;
                }
            })

            const plusDiv = document.createElement('div');
            plusDiv.style = "width: 25px; height: 25px; position: absolute; right: 0.8em; bottom: 0.8em; border: 2px solid #BBB; text-align: center; padding: auto; font-size: 18px; background-color: #222; cursor: pointer"
            plusDiv.innerText = "+"
            plusDiv.onclick = () => {
                pz.smoothZoom(0, 0, 1.2)
            }
            el.parentNode.appendChild(plusDiv);

            const minusDiv = document.createElement('div');
            minusDiv.style = "width: 25px; height: 25px; position: absolute; right: 2.4em; bottom: 0.8em; border: 2px solid #BBB; text-align: center; padding: auto; font-size: 18px; background-color: #222; cursor: pointer"
            minusDiv.innerText = "-"
            minusDiv.onclick = () => {
                pz.smoothZoom(0, 0, 0.8)
            }
            el.parentNode.appendChild(minusDiv);
        }
    })

    // Callback for use in mermaid diagrams that will open a relative doc link when clicking.
    //
    // Example doc link for `arg` would be: jumpy/session/struct.SessionManager.html
    window.docLink = (arg) => {
        let pathElems = new URL(window.location.href).pathname.split('/').filter(x => x != '');
        for (let i = pathElems.length - 1; i > -1; i--) {
            if (pathElems[i] != 'jumpy' && pathElems[i] != 'jumpy_core') {
                pathElems = pathElems.slice(0, i - 1);
                break;
            }
        }
        window.location.href = '/' + pathElems.join('/') + '/' + arg;
    }
</script>
<style>
    /*
        Hide the lock icons shown for private items. It isn't helpful
        in this context.
    */
    [title="Restricted Visibility"] {
        display: none;
    }

    .mermaid {
        overflow: hidden !important;
        border: 1px solid #BBB;
        border-radius: 1em;
        cursor: move;
        position: relative;
    }

    .dotted rect {
        stroke-dasharray: 5;
    }

    .code .nodeLabel {
        color: #2dbfb8 !important;
    }

    .code rect {
        transition: 0.2s;
        stroke: #2dbfb8 !important;
    }

    .code:hover rect {
        transform: scale(1.05)
    }
</style>

</head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../jumpy/index.html"><div class="logo-container"><img src="https://avatars.githubusercontent.com/u/87333478?s=200&amp;v=4" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../jumpy/index.html"><div class="logo-container">
                    <img src="https://avatars.githubusercontent.com/u/87333478?s=200&amp;v=4" alt="logo"></div></a><h2 class="location"><a href="#">Module networking</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#statics">Statics</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Module <a href="../index.html">jumpy</a>::<wbr><a class="mod" href="#">networking</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/jumpy/networking.rs.html#1-376">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Networked multi-player plugin.</p>
<p>Jumpy uses a Peer-to-Peer, rollback networking model built on <a href="https://github.com/gschup/ggrs">GGRS</a>.</p>
<p>Messages are serialized/deserialized to a binary representation using <a href="https://docs.rs/serde"><code>serde</code></a> and the <a href="https://docs.rs/postcard"><code>postcard</code></a>
crate.</p>
<p>The major facets of our networking are:</p>
<ul>
<li><strong><a href="#matchmaking">Matchmaking</a>:</strong> How we connect clients to each-other and start an network match.</li>
<li><strong><a href="#synchronization">Synchronization</a>:</strong> How we synchronize a network game between multiple players.</li>
</ul>
<h3 id="matchmaking"><a href="#matchmaking">Matchmaking</a></h3>
<p>There are currently two different matchmaking strategies: <a href="online/index.html" title="online"><code>online</code></a> and <a href="lan/index.html" title="lan"><code>lan</code></a>. Both of those
modules contain their own matchmaker with docs on how it works. Eventually we will probably have
additional matchmakers for Steam and the browser.</p>
<p>Regardless of the matchmaker, the goal is to find a match and establish a connection to the other
players. Once a match is established, the matchmaker must provide an implementation of
<a href="trait.NetworkSocket.html" title="NetworkSocket"><code>NetworkSocket</code></a> that may be used to send <a href="https://github.com/gschup/ggrs">GGRS</a>, reliable, and unreliable messages.</p>
<p>Each matchmaker is free to implement this socket with whatever networking transport they wish,
allowing the Steam matchmaker, for example, to use the steam networking library, and the browser
matchmaker to use <code>WebTransport</code> or <code>WebRTC</code>.</p>
<h3 id="synchronization"><a href="#synchronization">Synchronization</a></h3>
<p>Match synchronization, as mentioned above, is accomplished with <a href="https://github.com/gschup/ggrs">GGRS</a>, wich is a re-imagining of
the <a href="https://github.com/pond3r/ggpo/tree/master">GGPO</a> network SDK.</p>
<p>The <a href="trait.NetworkSocket.html" title="NetworkSocket"><code>NetworkSocket</code></a> trait, which matchmakers are required to implement for their sockets, is
required to return an implementation of GGRS’s <a href="https://docs.rs/ggrs/0.9.2/ggrs/trait.NonBlockingSocket.html"><code>NonBlockingSocket</code></a> trait, so that it can send it’s
unreliable messages. The exact method for sending these messages depends on the matchmaker.</p>
<p>The key requirement for rollback networking is:</p>
<ul>
<li>The synchronized game loop must be <strong>deterministic</strong>.</li>
<li>We must have the ability to <strong>snapshot</strong> and <strong>restore</strong> the game state.</li>
<li>We must be able to run up to 8 game simulation frames in 16ms ( to achieve a 60 FPS frame rate,
even in the case where we have to rollback and re-simulate ).</li>
</ul>
<p>These requirements are provided for primarily by <a href="https://fishfolk.github.io/bones/rustdoc/bones_lib/index.html"><code>bones_lib</code></a>. The core match logic is implemented
in <a href="../prelude/struct.CoreSession.html" title="::jumpy_core::session::CoreSession"><code>jumpy_core::session::CoreSession</code></a>, allowing us to advance
the game, snapshot the game, and restore it.</p>
<p>The integration with GGRS is implemented by the <a href="struct.GgrsSessionRunner.html" title="GgrsSessionRunner"><code>GgrsSessionRunner</code></a>.</p>
<h3 id="development--debugging"><a href="#development--debugging">Development &amp; Debugging</a></h3>
<p>Here are some tips for debugging networking features while developing.</p>
<h4 id="local-sync-test"><a href="#local-sync-test">Local Sync Test</a></h4>
<p>It can be cumbersome to start a new networked match every time you need to troubleshoot some part of
the game that may not be rolling back or restoring properly. To help with this, you can run the game
with the <code>--sync-test-check-distance 7</code> to make the game test rolling back and forward 8 times every
frame as a test when starting a local game.</p>
<p>This allows you to test the rollback without having to connect to a server. If things start popping
around the map or having other weird behaviors that they don’t have without the sync-test mode, then
you know you have a rollback issue.</p>
<blockquote>
<p><strong>ℹ️ Note:</strong> Just because you <strong>don’t</strong> have an issue in sync test mode, doesn’t mean that there
is no determinism issues. You still have to test network games with multiple game instances. There
are some non-determinism issues that only exhibit themselves when restarting the game.</p>
</blockquote>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="certs/index.html" title="jumpy::networking::certs mod">certs</a></div><div class="item-right docblock-short">QUIC certificate utilities.</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="debug/index.html" title="jumpy::networking::debug mod">debug</a></div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="lan/index.html" title="jumpy::networking::lan mod">lan</a></div><div class="item-right docblock-short">LAN matchmaking and socket implementation.</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="online/index.html" title="jumpy::networking::online mod">online</a></div><div class="item-right docblock-short">Contains the online matchmaker and the <a href="trait.NetworkSocket.html" title="NetworkSocket"><code>NetworkSocket</code></a> implementation.</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="proto/index.html" title="jumpy::networking::proto mod">proto</a></div><div class="item-right docblock-short">Serializable data types for network messages used by the game.</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BoxedNonBlockingSocket.html" title="jumpy::networking::BoxedNonBlockingSocket struct">BoxedNonBlockingSocket</a></div><div class="item-right docblock-short">A type-erased <a href="../external/ggrs/trait.NonBlockingSocket.html" title="crate::external::ggrs::NonBlockingSocket"><code>ggrs::NonBlockingSocket</code></a>
implementation.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GgrsConfig.html" title="jumpy::networking::GgrsConfig struct">GgrsConfig</a></div><div class="item-right docblock-short">The <a href="../external/ggrs/trait.Config.html" title="ggrs::Config"><code>ggrs::Config</code></a> implementation used by Jumpy.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GgrsSessionRunner.html" title="jumpy::networking::GgrsSessionRunner struct">GgrsSessionRunner</a></div><div class="item-right docblock-short"><a href="../session/trait.SessionRunner.html" title="SessionRunner"><code>SessionRunner</code></a> implementation that uses <a href="../external/ggrs/index.html" title="crate::external::ggrs"><code>ggrs</code></a> for network play.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.GgrsSessionRunnerInfo.html" title="jumpy::networking::GgrsSessionRunnerInfo struct">GgrsSessionRunnerInfo</a></div><div class="item-right docblock-short">The info required to create a <a href="struct.GgrsSessionRunner.html" title="GgrsSessionRunner"><code>GgrsSessionRunner</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.NetworkMatchSocket.html" title="jumpy::networking::NetworkMatchSocket struct">NetworkMatchSocket</a></div><div class="item-right docblock-short">Resource containing the <a href="trait.NetworkSocket.html" title="NetworkSocket"><code>NetworkSocket</code></a> implementation while there is a connection to a
network game.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.SocketTarget.html" title="jumpy::networking::SocketTarget enum">SocketTarget</a></div><div class="item-right docblock-short">The destination for a reliable network message.</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.NETWORK_FRAME_RATE_FACTOR.html" title="jumpy::networking::NETWORK_FRAME_RATE_FACTOR constant">NETWORK_FRAME_RATE_FACTOR</a></div><div class="item-right docblock-short">The muliplier for the <a href="../../jumpy_core/constant.FPS.html" title="jumpy_core::FPS"><code>jumpy_core::FPS</code></a> that will be used when playing an online match.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.NETWORK_MAX_PREDICTION_WINDOW.html" title="jumpy::networking::NETWORK_MAX_PREDICTION_WINDOW constant">NETWORK_MAX_PREDICTION_WINDOW</a></div><div class="item-right docblock-short">Number of frames client may predict beyond confirmed frame before freezing and waiting
for inputs from other players.</div></div></div><h2 id="statics" class="small-section-header"><a href="#statics">Statics</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="static" href="static.NETWORK_ENDPOINT.html" title="jumpy::networking::NETWORK_ENDPOINT static">NETWORK_ENDPOINT</a></div><div class="item-right docblock-short">The network endpoint used for all QUIC network communications.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.NetworkSocket.html" title="jumpy::networking::NetworkSocket trait">NetworkSocket</a></div><div class="item-right docblock-short">Trait that must be implemented by socket connections establish by matchmakers.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_dense_input.html" title="jumpy::networking::get_dense_input fn">get_dense_input</a><span title="Restricted Visibility">&nbsp;🔒</span> </div><div class="item-right docblock-short">Get a <a href="proto/struct.DensePlayerControl.html" title="proto::DensePlayerControl"><code>proto::DensePlayerControl</code></a> from a normal <a href="../../jumpy_core/input/struct.PlayerControl.html" title="PlayerControl"><code>PlayerControl</code></a>.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="jumpy" data-themes="" data-resource-suffix="" data-rustdoc-version="1.67.0 (fc594f156 2023-01-24)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-af96d9e2fc13e081.css" ></div></body></html>